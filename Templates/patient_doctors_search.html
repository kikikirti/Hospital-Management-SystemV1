{% extends "patient_base.html" %}
{% block title %}Search Doctors{% endblock %}
{% block content %}

<h2 class="h4 mb-3">Search for Doctors</h2>

<form method="get" class="row g-2 mb-3">
    <div class="col-md-6">
        {{ form.q.label(class="form-label") }}
        {{ form.q(class="form-control", size=32, placeholder="Search by name or specialization") }}
    </div>
    <div class="col-md-auto align-self-end">
        <button type="submit" class="btn btn-primary">Search</button>
    </div>
</form>

{% if doctors %}
<div class="card shadow-sm">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover table-sm mb-0 align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Doctor</th>
                        <th>Specialization</th>
                        <th>Availability (next 7 days)</th>
                        <th class="text-end">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for d in doctors %}
                    <tr>
                        <td>Dr. {{ d.user.name }}</td>
                        <td>{{ d.specialization or "General" }}</td>
                        <td>
                            {% for dt in days %}
                                <span class="me-1">
                                    {{ dt.strftime('%d-%b') }}:
                                    <strong>{{ availability_summary[d.id][loop.index0] }}</strong>
                                </span>
                                {% if not loop.last %}|{% endif %}
                            {% endfor %}
                        </td>
                        <td class="text-end">
                            <a href="{{ url_for('patient.book_appointment', doctor_id=d.id) }}"
                               class="btn btn-sm btn-outline-primary">
                                Book Appointment
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% else %}
<p class="text-muted">No doctors found matching your search.</p>
{% endif %}

{% endblock %}
